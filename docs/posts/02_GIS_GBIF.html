<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matic Jančič (&amp; Peter Glasnović); Department of biodiversity, University of Primorska">
<meta name="dcterms.date" content="2023-03-22">
<meta name="description" content="Workshop Day 2 at Faculty of Natural Sciences, Juraj Dobrila University of Pula">

<title>Matic Jančič: Teaching portfolio - ACCESSING MARINE SPECIES OCCURENCES IN R WITH RGBIF</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-binding-2.2.0.9000/leaflet.js"></script>
<script src="../site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="../site_libs/leaflet-providers-plugin-2.2.0.9000/leaflet-providers-plugin.js"></script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Matic Jančič: Teaching portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/maticjancic" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/maticjancic/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.researchgate.net/profile/Matic-Jancic" rel="" target="">
 <span class="menu-text"><i class="ai  ai-researchgate" title="" style="color:"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0002-6872-4078" rel="" target="">
 <span class="menu-text"><i class="ai  ai-orcid" title="" style="color:"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:maticjanchich@gmail.com" rel="" target=""><i class="bi bi-https://icons.getbootstrap.com/icons/envelope-at/" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">ACCESSING MARINE SPECIES OCCURENCES IN R WITH RGBIF</h1>
                  <div>
        <div class="description">
          Workshop Day 2 at Faculty of Natural Sciences, Juraj Dobrila University of Pula
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Introduction to marine ecological data in R</div>
                <div class="quarto-category">Introduction to GIS in R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Matic Jančič (&amp; Peter Glasnović); Department of biodiversity, University of Primorska </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 22, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-global-biodiversity-information-facility" id="toc-what-is-global-biodiversity-information-facility" class="nav-link active" data-scroll-target="#what-is-global-biodiversity-information-facility">What is Global Biodiversity Information Facility?</a></li>
  <li><a href="#how-to-access-species-occurence-data-from-gbif" id="toc-how-to-access-species-occurence-data-from-gbif" class="nav-link" data-scroll-target="#how-to-access-species-occurence-data-from-gbif">How to access species occurence data from GBIF?</a></li>
  <li><a href="#how-to-simply-map-the-occurences" id="toc-how-to-simply-map-the-occurences" class="nav-link" data-scroll-target="#how-to-simply-map-the-occurences">How to simply map the occurences?</a></li>
  <li><a href="#partly-funded-by-eu-erasmus-programme-for-higher-education-staff-mobility." id="toc-partly-funded-by-eu-erasmus-programme-for-higher-education-staff-mobility." class="nav-link" data-scroll-target="#partly-funded-by-eu-erasmus-programme-for-higher-education-staff-mobility."><img src="05_images/EU Erasmuslogo.jpg" class="img-fluid" alt="Partly funded by EU Erasmus+ Programme for Higher Education Staff Mobility."></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this lab, you will be introduced to:</p>
<ul>
<li>Global Biodiversity Information Facility (GBIF) database,</li>
<li>installing and loading R packages,</li>
<li>using R code to access the marine species occurrence data on GBIF server and download it,</li>
<li>data filtering and selecting to retain only information of interest,</li>
<li>simple visualization of spatial points.</li>
</ul>
</div>
</div>
<hr>
<section id="what-is-global-biodiversity-information-facility" class="level3">
<h3 class="anchored" data-anchor-id="what-is-global-biodiversity-information-facility">What is Global Biodiversity Information Facility?</h3>
<p>Global Biodiversity Information Facility (GBIF) is an international network and data infrastructure. It is funded by the world’s governments and aimed at providing anyone, anywhere, <strong>open access</strong> to data about all types of life on Earth.</p>
<p>At the time of writing this study materials, there were <strong>more than 2.2 billion records</strong> published in the GBIF database, in both marine and terrestrial realm on a global scale. The webpage itself is very practical in terms of navigation and search, but what is even better is that occurrence data can be easily accessed and downloaded through R either for a species or taxa of interest.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Open the <a href="https://www.gbif.org/">GBIF</a> website and explore it for a couple of minutes.</p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05_images/GBIF.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Global Biodiversity Information Facility landing site some time ago</figcaption>
</figure>
</div>
<p>Data from GBIF can be downloaded manually and than imported to R. However, programmers are lazy, so biologists can be lazy as well, right? For that purpose, there is an R package called <code class="sourceCode r">rgbif</code>. It contains functions that enable us to contact GBIF server directly, communicate with it and get only the data that we are interested in. In R, we first need to install a package using <code class="sourceCode r"><span class="fu">install.packages</span>()</code> function <strong>with the name of the package in quotation marks within the parenthesis</strong>. This should automatically download and install the package. We also need to load the package each time that we start or restart R or RStudio. This is done with <code class="sourceCode r"><span class="fu">library</span>()</code> function <strong>with the name of package without quotation marks in the parenthesis</strong>. Each package commes with a document in which all important information are available, example for <code class="sourceCode r">rgbif</code> can be accessed <a href="https://cran.r-project.org/web/packages/rgbif/rgbif.pdf">here</a>. More popular packages usually have informative “cheat sheets” as well (example later on).</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When installing R we “only” get access to some functionalities that are available. That is because there are really many available and individual user doesn’t need most of them. To add new functionalities, we need to install additional R packages from the internet (imagine R package as an add-on or extension of the base installation). <u>Installation needs to be done only once, before the first use of the package!</u></p>
<p>However, installing the package does not make it available for use. Again, not all packages are needed all the time so we have to <u>load the package each time we restart R or RStudio to be able to use it!</u></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Open an empty R script from the <code class="sourceCode r">File</code> dropdown menu by clicking <code class="sourceCode r">New file \ R script</code>. The script will have a name Untitled1 (or Untitled2, if a blank script was already open).</p>
<p>Save the script to the Desktop of your computer and name it <code>Accessing marine species data with R</code>.</p>
<p>Copy and paste below code to the R script, move cursor to the first row with code and click <code class="sourceCode r">Run</code>. Move cursor to each row that contains code and repeat.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"rgbif"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgbif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-access-species-occurence-data-from-gbif" class="level3">
<h3 class="anchored" data-anchor-id="how-to-access-species-occurence-data-from-gbif">How to access species occurence data from GBIF?</h3>
<p>To access the occurrence data we will use <code class="sourceCode r"><span class="fu">occ_search</span>()</code> function, which will contact the GBIF server and download the data from the database. We will take the fin whale (<em>Balaenoptera physalus</em>) as an example.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05_images/fin whale.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Fin whale (photo credit: https://www.flickr.com/photos/slobirdr/29414853626)</figcaption>
</figure>
</div>
<p>We introduced functions yesterday and said that we give them some object to get a result. Apart from objects that we create, functions accept other input as well. This input can provided as different <code>arguments</code> of the functions, for example the <code class="sourceCode r"><span class="fu">occ_search</span>()</code> function has an argument called <code class="sourceCode r">scientificName <span class="ot">=</span> <span class="cn">NULL</span></code>, set to <code>NULL</code> by default. If we want to use this function to search for fin whale occurences on GBIF server, we need to change it to <code class="sourceCode r">scientificName <span class="ot">=</span> <span class="st">"Balaenoptera physalus"</span></code>. Note that the latin name is written within the quotation marks for R to treat it as a word. There are many arguments that we could use, to refine our search (i.e.&nbsp;<code>hasCoordinate</code>, <code>country</code>, <code>continent</code>, etc.), but we will not use at this point.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you ever need to get information about any R function, type the question mark before its name (without parenthesis) and its documentation will open in the Help tab.</p>
</div>
</div>
<p>Below code will first open the documentation for <code class="sourceCode r"><span class="fu">occ_search</span>()</code> function and than store the results of it to <code class="sourceCode r">physalus_gbif</code> object, which should appear in your Global environment shortly after running the code.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Copy and paste below code to the R script, move cursor to the row with the code and click <code class="sourceCode r">Run</code>. <u>Explore the document that will open in the Help tab.</u></p>
<p><code class="sourceCode r">Run</code> the second line of the code and check your working directory, if a new object was created. As we will all be contacting the GBIF server at the same time, it might take a while for all requests to be processed and finished.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>?occ_search</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>physalus_gbif <span class="ot">&lt;-</span> <span class="fu">occ_search</span>(<span class="at">scientificName =</span> <span class="st">"Balaenoptera physalus"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Right of <code class="sourceCode r">physalus_gbif</code> object you can see what type of an R object it is: a list of 5 elements. If you click on the small blue icon left of the <code class="sourceCode r">physalus_gbif</code>, its content will be displayed below. You can see that we actually downloaded a lot of stuff. There are three lists called <code>meta</code>, <code>hierarchy</code> and <code>media</code> (far below), and a tibble or dataframe called <code>data</code>. Fifth element is not even listed as the first four have so much content that it was not printed in this display. We could explore all of this elements, but will look only at the <code>data</code> part, where coordinates and other information on the records are stored. In the display, you can see a dollar sign (<code>$</code>) in front of an element name. This is not coincidence, as it tells us, that we can access this part of the list by adding <code>$data</code> after its name. We will save the result of this operation to yet another object, that we will name <code class="sourceCode r">physalus_data</code>, which is a dataframe and which will be our dataset for further exploration.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Copy and paste below code to the R script, move cursor to the row with code and click <code class="sourceCode r">Run</code>. Check your working directory if a new object was created.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>physalus_data <span class="ot">&lt;-</span> physalus_gbif<span class="sc">$</span>data </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Questions:</p>
<ul>
<li>Is <code class="sourceCode r">physalus_data</code> indeed a dataframe (or a tibble) as it was the <code>$data</code> element of <code class="sourceCode r">physalus_gbif</code>?</li>
<li>How do you know that and is there an R function with which you can check that out?</li>
<li>How many rows and columns does <code class="sourceCode r">physalus_data</code> dataframe has?</li>
<li>How do you know that and are there R functions with which you can check that out?</li>
</ul>
<p>Do you have any questions?</p>
<hr>
<p>There are 500 observations of fin whales in the table, which is not necessarily the actual number of occurences in the database. To prevent server (over)load the default is to download 500 occurrences. This is the case for fin whales as well, as there are 113728 occurrences in the GBIF database (check <a href="https://www.gbif.org/species/2440718">here</a>). To change the number of downloaded occurrences, we would need to change the argument <code>limit =</code> to the desired value (however, note that <em>100,000 is the maximum limit set by package creators</em>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Click on the <code class="sourceCode r">physalus_data</code> object, its content should get displayed where your R script is open. <u>Explore the table and try to identify columns that can be useful for us (i.e.&nbsp;coordinates, year, etc).</u></p>
</div>
</div>
<p>Note that everything in R can be done in multiple ways. We will look at filtering (using a condition and retain a subset of observations - rows) and selecting (retaining only columns of interest) parts of our data using <code class="sourceCode r">dplyr</code> R package. The same could be achieved using only <code class="sourceCode r">base R</code> or advanced packages such as <code class="sourceCode r">data.table</code>. R package <code class="sourceCode r">dplyr</code> is very suitable for R beginners as it is very intuitive, but nevertheless very useful and powerful. Remember from above, we need to firs install the package and than load it, for its functions to be available.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Copy and paste below code to the R script, move cursor to the row with code and click <code class="sourceCode r">Run</code>. Check your working directory if a new object was created.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For <strong>selecting</strong> columns of a dataframe we use <code class="sourceCode r"><span class="fu">select</span>()</code> function which takes two arguments: the name of data object we want to select from and the name of column we want to select. With <code class="sourceCode r"><span class="fu">select</span>()</code><strong>we can choose multiple columns</strong>. Of more than 100 columns that were downloaded, only some have meaningful values for us at this moment. … We will retain several, that are listed … For <strong>filtering</strong> by row values we use <code class="sourceCode r"><span class="fu">filter</span>()</code> function which also takes two arguments: the name of data object we want to select from and the expression based on which we want to filter. For example, we do not want fin whale observation with large cordinate uncertatinty, right? To retain only those with 5 km or less, we simply need to specify the name of the column <code>coordinateUncertaintyInMeters</code> and the filtering condition (<code>&lt; 5000</code>). 5 km is not that bad considering the movement capabilities of fin whales, right? We will save results of selecting and filtering in <code class="sourceCode r">physalus_data</code> object, which will overwrite the original object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>physalus_data <span class="ot">&lt;-</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(physalus_data,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>         species,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         decimalLatitude,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         decimalLongitude,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         coordinateUncertaintyInMeters,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>         country) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coordinateUncertaintyInMeters <span class="sc">&lt;</span> <span class="dv">5000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Functions <code class="sourceCode r"><span class="fu">select</span>()</code> and <code class="sourceCode r"><span class="fu">filter</span>()</code> are defined in multiple R packages. Depending on which package was loaded last by <code class="sourceCode r"><span class="fu">library</span>()</code>, R chooses which version of the function it will apply. If we do not get the expected result from the function or an unexpected error after running it, this is the likeliest cause.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>We can avoid problems with commonly named functions by telling R <em>a priori</em> which function from which package we want to use. For example, <code class="sourceCode r"><span class="fu">select</span>()</code> or <code class="sourceCode r"><span class="fu">filter</span>()</code> from <code class="sourceCode r">dplyr</code> as follows:</p>
<ul>
<li><code class="sourceCode r">dplyr<span class="sc">::</span><span class="fu">filter</span>()</code>,</li>
<li><code class="sourceCode r">dplyr<span class="sc">::</span><span class="fu">select</span>()</code>.</li>
</ul>
</div>
</div>
</section>
<section id="how-to-simply-map-the-occurences" class="level3">
<h3 class="anchored" data-anchor-id="how-to-simply-map-the-occurences">How to simply map the occurences?</h3>
<p>Now that we have downloaded and filtered the data, we can simply display them on a map. Again, many options in R are available. We will use <code class="sourceCode r">leaflet</code> package which provides an easy way for creating interactive maps. The function for starting a map is <code class="sourceCode r"><span class="fu">leaflet</span>()</code> and we need to specify which object we want to map, in our case this will be <code class="sourceCode r">physalus_data</code>. Next, we use <code class="sourceCode r"><span class="fu">addProviderTiles</span>()</code> to add a background to our map. We also need to select one of the available options, for example <code class="sourceCode r">provider <span class="ot">=</span> <span class="st">"Esri.WorldImagery"</span></code> we specify which type of background. You can explore other options for background <a href="http://leaflet-extras.github.io/leaflet-providers/preview/">here</a>. You change the background by replacing <code class="sourceCode r"><span class="st">"Esri.WorldImagery"</span></code> with another name, i.e.&nbsp;<code class="sourceCode r"><span class="st">"OpenTopoMap"</span></code>. Next we add our points with function <code class="sourceCode r"><span class="fu">addCircleMarkers</span>()</code>, within which we must specify names of columns in our data that represent longitude (<code class="sourceCode r">lon</code>) and latitude (<code class="sourceCode r">lat</code>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Copy and paste below code to the R script, move cursor to the row with code and click <code class="sourceCode r">Run</code>. Move cursor to each row that contains code and repeat. The code starting with <code>leaflet(physalus_data)</code> should run from the start to the end after one click on <code class="sourceCode r">Run</code></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"leaflet"</span>) </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(physalus_data) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addProviderTiles</span>(<span class="st">"Esri.WorldImagery"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addCircleMarkers</span>(<span class="at">lng =</span> <span class="sc">~</span> decimalLongitude,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lat =</span> <span class="sc">~</span> decimalLatitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-dffee8b6c61947f5d0c6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-dffee8b6c61947f5d0c6">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[27.216506,27.236072,33.61797,33.62685,42.85063,40.8822,42.80058,42.75055,41.07455,33.487337,33.482548,33.490328,33.436895,33.44015,33.433327,33.601635,33.605817,33.542677,33.546603,33.546738,33.545587,33.543295,33.543295,33.549765,25.887477,25.887102,25.886765,40.9292,42.64977,42.90094,43.05034,32.571813,-61.064495,-61.129025,-63.285664,24.413979,41.61222,41.9038,42.50048,40.16677,40.1719,41.52037,41.52317,42.20488,42.19646,42.60036,41.89201,42.22017,43.02713,43.16818,40.1727,40.17312,42.60037,42.61024,42.96048,42.97179,42.30032,40.87366,48.871672,52.593966,52.65845,49.870605,-54.172445,-54.197826,-54.260208,36.827993,36.827993,36.827993,52.656597,52.656597,52.656597,52.656597,52.656597,42.16511,42.21546,42.30084,42.28164,41.62019,42.15014,42.35234,42.46102,42.16344,42.34661,42.15748,42.32255,42.13443,42.13988,42.25027,43.00034,42.25383,42.17637,42.14916,42.27427,40.09724,40.18079,40.00772,40.35777,39.99934,40.34386,40.56431,40.18142,40.12119,40.34474,40.26154,41.37383,40.24691,41.34692,40.54712,40.55318,40.56261,40.53031,40.17184,40.28539,40.25663,40.00871,40.41107,40.08702,40.09973,71.168373,71.168373,71.171093,68.345079,71.174238,41.041245,41.041245,70.379913,70.379913,73.944633,71.69788800000001,74.69801099999999,75.098668,71.69788800000001,73.94478100000001,74.71717700000001,70.390809,33.337538,40.2688,39.97904,40.0672,39.99998,40.61975,40.61543,42.22386,40.00317,41.74139,41.75805,41.62432,41.57649,40.00023,40.00033,41.51804,39.9873,40.18723,40.16507,40.60476,40.33073,40.89552,41.79663,40.30273,41.60308,41.53035,40.60243,41.16418,41.26951,40.53968,41.00195,40.53286,41.16719,41.30846,41.36656,40.16795,40.65175,40.66759,41.29222,40.20472,41.36115,41.44294,41.48815,41.50222,41.51287,41.51505,40.55692,40.67859,40.17589,40.77597,40.31156,40.28689,40.73585,40.79188,40.81857,40.78521,40.56493,40.23886,40.16769,42.01881,40.32814,40.52966,40.53675,41.19997,41.20743,42.85063,42.80112,42.80109,42.75034,42.90091,42.9009,42.85049,42.85049,42.8506,40.82653,41.44822,41.54607,40.63616,41.57361,70.540891,70.388322,71.193054,70.542481,33.725603,48.31641,48.31598,48.32082,48.31319,48.3428,48.32374,48.33585,48.3247,48.35235,40.53496,40.83178,40.83607,40.8395,40.5639,40.57387,48.40381,40.58335,40.58339,40.55867,40.29509,40.00997,48.47138,40.27154,40.48967,40.31123,48.41751,40.58341,40.0007,39.9999,40.0001,48.43283,48.42812,48.24935,40.25259,40.418,48.43073,48.39748,40.00014,70.542678,70.492788,71.091168,70.54131,70.401323,71.06360100000001,70.375136,70.375136,45.069637,48.130454,51.809203,43.531171,45.026711,45.565548,66.002171,39.2,43.54017,42.877625,40.12997,40.13521,40.00002,40.00022,40.00023,39.99998,41.07245,40.14841,40.42341,40.08921,40.30574,40.32315,40.44401,42.88696,40.15676,40.16205,40.20834,40.20557,39.62183,39.62134,39.61104,40.20984,39.58403,39.58403,39.58405,40.38019,40.15361,40.40198,40.35484,40.34895,39.50184,40.13974,40.1198,40.52161,39.50113,39.5036,40.16678,40.12199,40.08359,39.75089,40.09967,40.11194,40.11039,39.78636,39.50306,39.5508,39.75087,40.23859,40.13799,40.08335,40.1026,40.10628,39.66795,39.66799,40.29039,40.17538,39.66807,39.66784,39.66792,42.61382,40.13732,51.94125,70.97623400000001,53.322884],[-112.113799,-112.110772,-118.248265,-118.256383,-70.15333,-69.81686000000001,-70.14747,-70.16293,-70.21648,-118.234225,-118.241205,-118.236167,-118.289422,-118.283343,-118.294013,-118.292185,-118.295262,-118.356892,-118.353588,-118.353573,-118.350062,-118.348447,-118.348447,-118.3602,-111.255048,-111.255282,-111.255463,-70.51119,-70.03359,-70.23272,-70.05486000000001,-16.915865,-54.535603,-54.551823,-56.804317,-110.42298,-68.87836,-68.95103,-70.39185000000001,-69.83334000000001,-69.83288,-69.44233,-69.43597,-70.42431000000001,-70.42431999999999,-70.35717,-68.94386,-70.30888,-70.17832,-70.14125,-70.95031,-70.96106,-70.30216,-70.30094,-68.96074,-68.95010000000001,-70.02925,-70.114,-64.20573899999999,-128.490903,-128.451783,0.717262,-35.567303,-35.60791,-35.745136,-121.961465,-121.961465,-121.961465,-128.451922,-128.451922,-128.451922,-128.451922,-128.451922,-70.20638,-70.32384999999999,-70.30992000000001,-70.75714000000001,-69.08158,-70.32644999999999,-70.34034,-70.21876,-70.39051000000001,-70.3302,-70.49677,-70.34027,-70.48106,-70.48331,-70.03197,-70.30139,-70.33045,-70.32472,-70.31796,-70.15773,-71.46696,-71.13348999999999,-70.96662999999999,-70.63633,-70.94506,-71.3,-72.31270000000001,-71.38333,-71.38334999999999,-71.3415,-71.29984,-69.29389,-71.3004,-69.35536,-72.26733,-72.28918,-72.30222999999999,-72.25748,-71.29306,-71.2998,-71.23324,-71.29975,-70.88351,-71.38336,-71.38338,25.781972,25.781972,25.712469,13.846533,25.796165,1.908875,1.908875,31.119308,31.119308,-7.762064,-8.259831,-5.906265,-5.031801,-8.259831,-7.762275,-5.853322,31.172075,-117.615337,-71.31655000000001,-71.25013,-70.98302,-70.7967,-70.23533999999999,-70.44391,-67.30240000000001,-70.97948,-69.8853,-69.89024000000001,-69.7675,-69.52701999999999,-70.76461999999999,-70.75427999999999,-69.65823,-71.08356000000001,-71.58356000000001,-71.58363,-71.71621,-71.00009,-67.10728,-68.44736,-68.2831,-68.14658,-68.36082,-68.81684,-68.99633,-68.95359999999999,-68.73322,-69.08015,-68.73322,-68.99034,-68.87249,-69.3614,-68.72457,-68.80437000000001,-68.83062,-69.27051,-68.65012,-69.38667,-69.52321999999999,-69.51604,-69.48432,-69.4599,-69.45487,-68.65004999999999,-67.03255,-69.06666,-67.29385000000001,-68.56671,-68.56668000000001,-67.83193,-67.33713,-67.40976999999999,-67.47376,-68.98327999999999,-68.56664000000001,-68.55898000000001,-68.48004,-68.89973999999999,-68.48336,-68.47323,-68.99343,-68.97681,-70.40385999999999,-70.23824,-70.22752,-70.35686,-70.19293,-70.18499,-70.19992999999999,-70.26338,-70.34009,-68.85091,-69.45525000000001,-69.55164000000001,-68.41282,-69.62430999999999,30.646107,31.179185,25.642722,30.63929,-118.182519,-63.9474,-63.96656,-63.92187,-63.91499,-64.01541,-63.97619,-64.00042999999999,-64.05764000000001,-63.86892,-70.61445999999999,-70.77467,-70.77697000000001,-70.77882,-70.86378000000001,-70.86913,-62.57351,-71.10599999999999,-71.06435,-71.04935,-71.46681,-70.96719,-63.9087,-71.38352999999999,-70.63337,-71.30032,-63.7505,-71.24124,-70.87254,-70.84246,-70.81889,-63.69845,-63.68319,-63.62016,-71.21652,-70.80011,-63.67485,-62.58815,-71.14494000000001,30.654272,30.632111,28.221114,30.643672,31.188105,28.280834,31.097914,31.097914,-66.93297800000001,-69.62364599999999,-10.285053,9.044495,-4.238235,-4.426687,-18.448697,0.41,9.196129000000001,6.131273,-71.23383,-71.21711999999999,-71.50488,-71.62851999999999,-71.66528,-71.89072,-70.93826,-71.31684,-70.73277,-69.45107,-68.51672000000001,-68.51675,-68.51672000000001,-69.92471,-71.30074,-71.28635,-70.96675999999999,-70.96675,-72.76915,-72.77334999999999,-72.78397,-70.61733,-72.94198,-72.95187,-72.96514999999999,-70.61726,-70.0331,-69.5788,-70.49968,-70.49966999999999,-72.79205,-70.49957000000001,-70.4996,-68.16630000000001,-72.39583,-72.40091,-71.31717999999999,-70.52213,-70.45524,-72.78851,-70.43349000000001,-70.44596,-70.45628000000001,-72.764,-72.24961,-72.21174999999999,-72.96313000000001,-69.68365,-71.20023999999999,-71.09610000000001,-71.08360999999999,-71.08365999999999,-73.09683,-73.06747,-71.63357999999999,-71.08367,-72.90852,-72.77968,-72.7551,-69.86903,-69.10004000000001,-7.712084,26.319641,-129.049904],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-63.285664,75.098668],"lng":[-129.049904,31.188105]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code class="sourceCode r"><span class="sc">%&gt;%</span></code> sign is used to “chain” operations, meaning that one operation follows the next in the specified order from top to bottom. This operator makes the code more compact, efficient and readable. Above code is therefore read as:</p>
<ol type="1">
<li>start the <code>leaflet()</code> map by taking <code class="sourceCode r">physalus_data</code> object</li>
<li>add <code>"Esri.WorldImagery"</code> background with <code class="sourceCode r"><span class="fu">addProviderTiles</span>()</code></li>
<li>add points with <code>addCircleMarkers()</code> that have coordinates stored in <code>~decimalLongitude</code> and <code>~ decimalLatitude</code> columns</li>
</ol>
</div>
</div>
<hr>
<p>We can export the map in the <code>html</code> format, which will retain its interactive properties:</p>
<ol type="1">
<li>Click <code>Export</code> button in the viewer</li>
</ol>
<p><img src="05_images/Export button.png" class="img-fluid"></p>
<ol start="2" type="1">
<li>Select <code>Save as web page</code></li>
</ol>
<p><img src="05_images/Save as web page.png" class="img-fluid"></p>
<ol start="3" type="1">
<li>Set the file name, choose location on our computer (Desktop) and click <code>Save</code></li>
</ol>
<p><img src="05_images/Save to project map.png" class="img-fluid"></p>
<hr>
<p>Questions to consider:</p>
<ul>
<li>What is GBIF and how can it be useful for your research/teaching?</li>
<li>What are the drawbacks of the GBIF data considering that some of it comes from citizen science?</li>
<li>How many times do you need to run <code>install.packages()</code> functions and how many times the <code>library()</code> function?</li>
<li>Which package and functions are easy to use for filtering and selecting only the data of interest?</li>
<li>Which package and functions are easy to use for simple spatial data visualization of spatial points?</li>
</ul>
<p>Do you have any questions?</p>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Today your task will be more challenging than those of yesterday. Follow the next steps to accomplish it:</p>
<ol type="1">
<li>Choose one marine species (your favorite) and find its Latin name.</li>
<li>Open new R script, save it to desktop and name it <code>Accessing "insert your species name" data with R</code> on the desktop.</li>
<li>Copy - paste all R code that we ran for fin whale example (you can exclude only <code>install.packages()</code>, as the packages are already on your computer now).</li>
<li>Adapt the code in a way that you replace <code>Balaenoptera physalus</code> with chosen species name and rename <code>physalus_gbif</code> according to your species (i.e.&nbsp;<code>Liza aurata</code> &amp; <code>aurata_gbif</code>).</li>
<li>Add the argument <code>limit =</code> to <code>occ_search()</code> function and download more than 500 occurrences (change 500 with a number of your choice).</li>
<li>Extract the data part of the <code>*_gbif</code> object and rename the object according to you species (i.e.&nbsp;<code>aurata_data</code>).
<ol type="a">
<li>if there are zero or a small number of occurrences of your species (&lt; 100), repeat from step 1.</li>
<li>if there are &gt; 100 occurrences of your species, proceed to step 7.</li>
</ol></li>
<li>Select only meaningful columns from the <code>*_data</code> dataframe. The column names should be the same as in the fin whale example and the code should work on your data. <u>Add a minimum three columns to the select function on top of the ones that I chose to select!</u></li>
<li>Apply filter to your data and try to change the filtering value of coordinate uncertainty to correspond to your species better (i.e.&nbsp;500 metres might be better for <em>Liza aurata</em>).</li>
<li>Display the filtered occurrences of your species on a leflet map. Explore the available base maps <a href="http://leaflet-extras.github.io/leaflet-providers/preview/">here</a> and change it to one of your choice (i.e.replace <code>"Esri.WorldImagery"</code> with <code>"Esri.WorldImagery"</code> or <code>"OpenTopoMap"</code>.</li>
</ol>
<p><u>If something doesn’t work straight away, first think about the problem/error, consult a neighbor on your left, then on your right. If after that you still don’t know how to fix the problem or proceed, ask me for help!</u></p>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Save both R scripts, so you can reuse your code in the following labs.</p>
<p>When you close R studio, select <code>Yes</code> when it asks if you want to save your work-space.</p>
</div>
</div>
<hr>
</section>
<section id="partly-funded-by-eu-erasmus-programme-for-higher-education-staff-mobility." class="level2">
<h2 class="anchored" data-anchor-id="partly-funded-by-eu-erasmus-programme-for-higher-education-staff-mobility."><img src="05_images/EU Erasmuslogo.jpg" class="img-fluid" alt="Partly funded by EU Erasmus+ Programme for Higher Education Staff Mobility."></h2>
<p>Partly funded by EU Erasmus+ Programme for Higher Education Staff Mobility</p>
<p><br></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>